Using launch settings from D:\GitHub\coffee-staff-management\backend\CoffeeStaffManagement.API\Properties\launchSettings.json...
Building...
D:\GitHub\coffee-staff-management\backend\CoffeeStaffManagement.Infrastructure\Persistence\DbInitializer.cs(72,21): warning CS8602: Dereference of a possibly null reference. [D:\GitHub\coffee-staff-management\backend\CoffeeStaffManagement.Infrastructure\CoffeeStaffManagement.Infrastructure.csproj]
D:\GitHub\coffee-staff-management\backend\CoffeeStaffManagement.Infrastructure\Persistence\DbInitializer.cs(78,21): warning CS8602: Dereference of a possibly null reference. [D:\GitHub\coffee-staff-management\backend\CoffeeStaffManagement.Infrastructure\CoffeeStaffManagement.Infrastructure.csproj]
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (79ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT a.id, a.created_at, a.full_name, a.password_hash, a.username
      FROM admin AS a
      WHERE a.username = 'admin'
      LIMIT 1
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (10ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT p.id, p.name, p.status
      FROM positions AS p
      WHERE p.name = 'Pha chế'
      LIMIT 1
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (11ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT p.id, p.name, p.status, s.id, s.end_time, s.is_enabled, s.name, s.position_id, s.start_time, s.status
      FROM positions AS p
      LEFT JOIN shifts AS s ON p.id = s.position_id
      WHERE p.name IN ('Pha chế (Parttime)', 'Pha chế (Thử việc)')
      ORDER BY p.id
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (6ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT s.id, s.end_time, s.is_enabled, s.name, s.position_id, s.start_time, s.status, p.id, p.name, p.status
      FROM shifts AS s
      INNER JOIN positions AS p ON s.position_id = p.id
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5136
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: D:\GitHub\coffee-staff-management\backend\CoffeeStaffManagement.API
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (167ms) [Parameters=[@employeeId='?' (DbType = Int32), @shiftId='?' (DbType = Int32), @workDate='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status
      FROM schedules AS s
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      WHERE s.employee_id = @employeeId AND s.shift_id = @shiftId AND s.work_date = @workDate
      LIMIT 1
fail: Microsoft.EntityFrameworkCore.Database.Command[20102]
      Failed executing DbCommand (123ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?', @p3='?' (DbType = Int32), @p4='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      INSERT INTO schedules (approved_at, employee_id, note, shift_id, work_date)
      VALUES (@p0, @p1, @p2, @p3, @p4)
      RETURNING id;
fail: Microsoft.EntityFrameworkCore.Update[10000]
      An exception occurred in the database while saving changes for context type 'CoffeeStaffManagement.Infrastructure.Persistence.AppDbContext'.
      Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
       ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "schedules" violates foreign key constraint "schedules_employee_id_fkey"
      
      DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
         at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
         at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
         at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
         at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
        Exception data:
          Severity: ERROR
          SqlState: 23503
          MessageText: insert or update on table "schedules" violates foreign key constraint "schedules_employee_id_fkey"
          Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
          SchemaName: public
          TableName: schedules
          ConstraintName: schedules_employee_id_fkey
          File: ri_triggers.c
          Line: 2783
          Routine: ri_ReportViolation
         --- End of inner exception stack trace ---
         at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
         at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
      Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
       ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "schedules" violates foreign key constraint "schedules_employee_id_fkey"
      
      DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
         at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
         at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
         at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
         at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
        Exception data:
          Severity: ERROR
          SqlState: 23503
          MessageText: insert or update on table "schedules" violates foreign key constraint "schedules_employee_id_fkey"
          Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
          SchemaName: public
          TableName: schedules
          ConstraintName: schedules_employee_id_fkey
          File: ri_triggers.c
          Line: 2783
          Routine: ri_ReportViolation
         --- End of inner exception stack trace ---
         at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
         at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
fail: CoffeeStaffManagement.API.Middleware.ExceptionHandlingMiddleware[0]
      An unhandled exception has occurred.
      Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
       ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "schedules" violates foreign key constraint "schedules_employee_id_fkey"
      
      DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
         at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
         at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
         at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
         at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
         at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
        Exception data:
          Severity: ERROR
          SqlState: 23503
          MessageText: insert or update on table "schedules" violates foreign key constraint "schedules_employee_id_fkey"
          Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
          SchemaName: public
          TableName: schedules
          ConstraintName: schedules_employee_id_fkey
          File: ri_triggers.c
          Line: 2783
          Routine: ri_ReportViolation
         --- End of inner exception stack trace ---
         at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
         at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
         at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
         at CoffeeStaffManagement.Infrastructure.Repositories.ScheduleRepository.AddAsync(Schedule schedule) in D:\GitHub\coffee-staff-management\backend\CoffeeStaffManagement.Infrastructure\Repositories\ScheduleRepository.cs:line 47
         at CoffeeStaffManagement.Application.Attendance.Commands.CreateAttendanceCommandHandler.Handle(CreateAttendanceCommand request, CancellationToken cancellationToken) in D:\GitHub\coffee-staff-management\backend\CoffeeStaffManagement.Application\Attendance\Commands\CreateAttendanceCommandHandler.cs:line 36
         at MediatR.Wrappers.RequestHandlerWrapperImpl`1.<>c__DisplayClass1_0.<<Handle>g__Handler|0>d.MoveNext()
      --- End of stack trace from previous location ---
         at CoffeeStaffManagement.API.Controllers.AttendanceController.Create(CreateAttendanceCommand command) in D:\GitHub\coffee-staff-management\backend\CoffeeStaffManagement.API\Controllers\AttendanceController.cs:line 59
         at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
         at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
         at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
         at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
         at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
         at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
         at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
         at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
         at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
         at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
         at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
         at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
         at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
         at CoffeeStaffManagement.API.Middleware.ExceptionHandlingMiddleware.InvokeAsync(HttpContext context) in D:\GitHub\coffee-staff-management\backend\CoffeeStaffManagement.API\Middleware\ExceptionHandlingMiddleware.cs:line 21
warn: Microsoft.AspNetCore.Server.Kestrel[22]
      As of "02/25/2026 08:08:57 +00:00", the heartbeat has been running for "00:00:06.9979720" which is longer than "00:00:01". This could be caused by thread pool starvation.
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (76ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status
      FROM employees AS e
      ORDER BY e.code
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (102ms) [Parameters=[@employeeId='?' (DbType = Int32), @shiftId='?' (DbType = Int32), @workDate='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status
      FROM schedules AS s
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      WHERE s.employee_id = @employeeId AND s.shift_id = @shiftId AND s.work_date = @workDate
      LIMIT 1
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (39ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?', @p3='?' (DbType = Int32), @p4='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      INSERT INTO schedules (approved_at, employee_id, note, shift_id, work_date)
      VALUES (@p0, @p1, @p2, @p3, @p4)
      RETURNING id;
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (57ms) [Parameters=[@employeeId='?' (DbType = Int32), @shiftId='?' (DbType = Int32), @workDate='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT a.id, a.check_in, a.check_out, a.employee_id, a.note, a.schedule_id, a.total_hours, e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status, s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status
      FROM attendance AS a
      INNER JOIN schedules AS s ON a.schedule_id = s.id
      INNER JOIN employees AS e ON a.employee_id = e.id
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      WHERE a.employee_id = @employeeId AND s.shift_id = @shiftId AND s.work_date = @workDate
      LIMIT 1
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (94ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?', @p4='?' (DbType = Int32), @p5='?' (DbType = Decimal)], CommandType='Text', CommandTimeout='30']
      INSERT INTO attendance (check_in, check_out, employee_id, note, schedule_id, total_hours)
      VALUES (@p0, @p1, @p2, @p3, @p4, @p5)
      RETURNING id;
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (90ms) [Parameters=[@workDate='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT a.id, a.check_in, a.check_out, a.employee_id, a.note, a.schedule_id, a.total_hours, e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status, s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status
      FROM attendance AS a
      INNER JOIN schedules AS s ON a.schedule_id = s.id
      INNER JOIN employees AS e ON a.employee_id = e.id
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      WHERE s.work_date = @workDate
      ORDER BY a.employee_id
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (179ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status
      FROM employees AS e
      ORDER BY e.code
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (44ms) [Parameters=[@username='?'], CommandType='Text', CommandTimeout='30']
      SELECT a.id, a.created_at, a.full_name, a.password_hash, a.username
      FROM admin AS a
      WHERE a.username = @username
      LIMIT 1
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (31ms) [Parameters=[@startDate='?' (DbType = DateTime), @endDate='?' (DbType = DateTime)], CommandType='Text', CommandTimeout='30']
      SELECT r.id, r.bank, r.cash, r.created_at, r.deviation, r.employee_id, r.net, r.note, r.opening_balance, r.schedule_id, r.revenue, s.id, t.id, t.amount, t.created_at, t.description, t.revenue_id, t.type, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date
      FROM revenues AS r
      INNER JOIN schedules AS s ON r.schedule_id = s.id
      LEFT JOIN transactions AS t ON r.id = t.revenue_id
      WHERE r.created_at >= @startDate AND r.created_at <= @endDate
      ORDER BY r.id, s.id
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (24ms) [Parameters=[@fromDate='?' (DbType = Date), @toDate='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status, p.id, p.name, p.status, a.id, a.check_in, a.check_out, a.employee_id, a.note, a.schedule_id, a.total_hours
      FROM schedules AS s
      INNER JOIN employees AS e ON s.employee_id = e.id
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      INNER JOIN positions AS p ON s0.position_id = p.id
      LEFT JOIN attendance AS a ON s.id = a.schedule_id
      WHERE s.work_date >= @fromDate AND s.work_date <= @toDate
      ORDER BY s.work_date
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (60ms) [Parameters=[@startDate='?' (DbType = DateTime), @endDate='?' (DbType = DateTime)], CommandType='Text', CommandTimeout='30']
      SELECT r.id, r.bank, r.cash, r.created_at, r.deviation, r.employee_id, r.net, r.note, r.opening_balance, r.schedule_id, r.revenue, s.id, t.id, t.amount, t.created_at, t.description, t.revenue_id, t.type, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date
      FROM revenues AS r
      INNER JOIN schedules AS s ON r.schedule_id = s.id
      LEFT JOIN transactions AS t ON r.id = t.revenue_id
      WHERE r.created_at >= @startDate AND r.created_at <= @endDate
      ORDER BY r.id, s.id
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (10ms) [Parameters=[@fromDate='?' (DbType = Date), @toDate='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT a.id, a.check_in, a.check_out, a.employee_id, a.note, a.schedule_id, a.total_hours, s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status, p.id, p.name, p.status
      FROM attendance AS a
      INNER JOIN schedules AS s ON a.schedule_id = s.id
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      INNER JOIN positions AS p ON s0.position_id = p.id
      WHERE s.work_date >= @fromDate AND s.work_date <= @toDate
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (38ms) [Parameters=[@fromDate='?' (DbType = Date), @toDate='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status, p.id, p.name, p.status, a.id, a.check_in, a.check_out, a.employee_id, a.note, a.schedule_id, a.total_hours
      FROM schedules AS s
      INNER JOIN employees AS e ON s.employee_id = e.id
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      INNER JOIN positions AS p ON s0.position_id = p.id
      LEFT JOIN attendance AS a ON s.id = a.schedule_id
      WHERE s.work_date >= @fromDate AND s.work_date <= @toDate
      ORDER BY s.work_date
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (2ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status
      FROM employees AS e
      ORDER BY e.code
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (9ms) [Parameters=[@fromDate='?' (DbType = Date), @toDate='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT a.id, a.check_in, a.check_out, a.employee_id, a.note, a.schedule_id, a.total_hours, s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status, p.id, p.name, p.status
      FROM attendance AS a
      INNER JOIN schedules AS s ON a.schedule_id = s.id
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      INNER JOIN positions AS p ON s0.position_id = p.id
      WHERE s.work_date >= @fromDate AND s.work_date <= @toDate
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (9ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status
      FROM employees AS e
      ORDER BY e.code
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (41ms) [Parameters=[@month='?' (DbType = Int32), @year='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT p.id, p.created_at, p.employee_id, p.month, p.total_salary, p.year, e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status
      FROM payrolls AS p
      INNER JOIN employees AS e ON p.employee_id = e.id
      WHERE p.month = @month AND p.year = @year
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (59ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status
      FROM employees AS e
      ORDER BY e.code
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (8ms) [Parameters=[@fromDate='?' (DbType = Date), @toDate='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT a.id, a.check_in, a.check_out, a.employee_id, a.note, a.schedule_id, a.total_hours, s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status, p.id, p.name, p.status
      FROM attendance AS a
      INNER JOIN schedules AS s ON a.schedule_id = s.id
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      INNER JOIN positions AS p ON s0.position_id = p.id
      WHERE s.work_date >= @fromDate AND s.work_date <= @toDate
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (3ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT p.id, p.name, p.status, s.id, s.end_time, s.is_enabled, s.name, s.position_id, s.start_time, s.status
      FROM positions AS p
      LEFT JOIN shifts AS s ON p.id = s.position_id
      ORDER BY p.name, p.id
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (46ms) [Parameters=[@fromDate='?' (DbType = Date), @toDate='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status, p.id, p.name, p.status, a.id, a.check_in, a.check_out, a.employee_id, a.note, a.schedule_id, a.total_hours
      FROM schedules AS s
      INNER JOIN employees AS e ON s.employee_id = e.id
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      INNER JOIN positions AS p ON s0.position_id = p.id
      LEFT JOIN attendance AS a ON s.id = a.schedule_id
      WHERE s.work_date >= @fromDate AND s.work_date <= @toDate
      ORDER BY s.work_date
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (17ms) [Parameters=[@startDate='?' (DbType = DateTime), @endDate='?' (DbType = DateTime)], CommandType='Text', CommandTimeout='30']
      SELECT r.id, r.bank, r.cash, r.created_at, r.deviation, r.employee_id, r.net, r.note, r.opening_balance, r.schedule_id, r.revenue, s.id, t.id, t.amount, t.created_at, t.description, t.revenue_id, t.type, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date
      FROM revenues AS r
      INNER JOIN schedules AS s ON r.schedule_id = s.id
      LEFT JOIN transactions AS t ON r.id = t.revenue_id
      WHERE r.created_at >= @startDate AND r.created_at <= @endDate
      ORDER BY r.id, s.id
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (57ms) [Parameters=[@date='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, e.id, e.barista_salary, e.cid, e.code, e.created_at, e.dob, e.gender, e.hire_date, e.name, e.phone, e.service_salary, e.status, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status, p.id, p.name, p.status
      FROM schedules AS s
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      INNER JOIN employees AS e ON s.employee_id = e.id
      INNER JOIN positions AS p ON s0.position_id = p.id
      WHERE s.work_date = @date
      ORDER BY s0.start_time
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (245ms) [Parameters=[@fromDate='?' (DbType = Date), @toDate='?' (DbType = Date)], CommandType='Text', CommandTimeout='30']
      SELECT a.id, a.check_in, a.check_out, a.employee_id, a.note, a.schedule_id, a.total_hours, s.id, s.approved_at, s.employee_id, s.note, s.shift_id, s.work_date, s0.id, s0.end_time, s0.is_enabled, s0.name, s0.position_id, s0.start_time, s0.status, p.id, p.name, p.status
      FROM attendance AS a
      INNER JOIN schedules AS s ON a.schedule_id = s.id
      INNER JOIN shifts AS s0 ON s.shift_id = s0.id
      INNER JOIN positions AS p ON s0.position_id = p.id
      WHERE s.work_date >= @fromDate AND s.work_date <= @toDate
warn: Microsoft.AspNetCore.Server.Kestrel[22]
      As of "02/25/2026 08:48:22 +00:00", the heartbeat has been running for "00:00:01.8663793" which is longer than "00:00:01". This could be caused by thread pool starvation.
